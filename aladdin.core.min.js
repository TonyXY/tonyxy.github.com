/*!
 * Aladdin.js v1.0.0-beta4
 * (c) 2016 Aladdin
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.aladdin=e()}(this,function(){"use strict";function t(t){if(t.env.isBrowser){var e=JSON.parse(sessionStorage.getItem("aladdinChromeExtensionInfo"));e&&(sessionStorage.removeItem("aladdinChromeExtensionInfo"),window.aladdin=t,e.activeRequire?window.aladdinChromeExtension&&window.aladdinChromeExtension.startListen(t):"complete"!==document.readyState&&document.write('<script src="'+e.injectScriptPath+'"></script>'))}window.__ALADDIN_CALLBACK__=function(){var e=arguments;setTimeout(function(){t.callback.apply(t,e)},0)},window.__ALADDIN_EVENT_EMIT__=function(){var e=arguments;setTimeout(function(){t.emit.apply(t,e)},0)}}function e(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function i(t,e,i){Object.defineProperty(t,e,{value:i,writable:!1})}function n(t){var e=function(e){e&&this.emit("error",e),t&&"function"==typeof t&&t.apply(null,arguments)}.bind(this);return e.keep=t.keep,e}function r(){this._handlers={},this._subscribers={},this._middlewares=[]}var o=navigator.userAgent,s=void 0,a=void 0,u=void 0,c=/AladdinHybrid\/(\d+\.\d+\.?\d*.*?) \((.*?) (\d+\.\d+\.?\d*.*?)\)/i.exec(o);Array.isArray(c)&&(s=c[1],a=c[2],u=c[3]);var f=s,d=a,p=u,l=/Mobile/i.test(o),h=/Android/i.test(o),y=!!o.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/i),m=/iPhone/i.test(o),b=/iPad/i.test(o),_=/iPod/i.test(o),v=!!s,w=!v,g=/MicroMessenger/i.test(o),A=/QQ/i.test(o),S=Object.freeze({hybridVersion:f,appName:d,appVersion:p,isMobile:l,isAndroid:h,isiOS:y,isiPhone:m,isiPad:b,isiPod:_,isHybrid:v,isBrowser:w,isWechat:g,isQQ:A}),C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};i(r.prototype,"version","1.0.0-beta4"),r.prototype.on=function(t,e){return t&&"string"==typeof t&&e&&"function"==typeof e?((this._subscribers[t]||(this._subscribers[t]=[])).push(e),this):this},r.prototype.once=function(t,e){var i=this,n=function n(){i.off(t,n),e.apply(this,arguments)};return n.listener=e,this.on(t,n),this},r.prototype.off=function(t,e){if(!arguments.length){for(t in this._subscribers)delete this._subscribers[t];return this}if(!t||"string"!=typeof t)return this;if(!e&&this._subscribers[t])return delete this._subscribers[t],this;for(var i=this._subscribers[t],n=void 0,r=i.length;r--;)if(n=i[r],n===e||n.listener===e){this._subscribers[t].splice(r,1);break}return this},r.prototype.emit=function(t){if(t&&"string"==typeof t){var e=this._subscribers[t];if(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var o in e)e[o].apply(null,n)}}return this},r.prototype.use=function(t){if("function"==typeof t){var e=new t(this),i=e.name||t.name.toLowerCase();if(!i)throw new Error("The component for anonymous function name attribute must be provided");this[i]=e}return this},r.prototype.middleware=function(t){return"function"==typeof t&&this._middlewares.push(t),this},r.prototype.support=function(t,e,i){if(!t)return this;"function"==typeof e&&(i=e,e="");var n={component:t,action:e};return this.call("support","component",n,i),this},r.prototype._transformHandlers=function(t,e,i,r){for(var o in i){var s=i[o];if("object"===("undefined"==typeof s?"undefined":C(s))&&this._transformHandlers(t,e,s,r),"function"==typeof s){var a=r+"_function_"+t+"_"+e+"_"+(isNaN(o)?o:"callback");i[o]=a,this._handlers[a]=n.call(this,s)}}},r.prototype.call=function(t,i){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var s={component:t,action:i,args:r,callId:e()};if(this._middlewares.length>0&&this._middlewares.reduce(function(t,e){return e(t)},s),this._transformHandlers(s.component,s.action,s.args,s.callId),s.url="aladdin://"+s.component+"."+s.action+"?"+encodeURIComponent(JSON.stringify(s.args)),this.emit("call",s),h)prompt(s.url);else if(y){var a=document.createElement("IFRAME");a.setAttribute("src",s.url),a.setAttribute("style","display: none;"),document.documentElement.appendChild(a),a.parentNode.removeChild(a),a=null}return this},r.prototype.callback=function(t){if(t){var e=this._handlers[t];if(e&&"function"==typeof e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];e.apply(null,n),e.keep||delete this._handlers[t]}}};var E=new r;return E.env=S,t(E),E});
//# sourceMappingURL=aladdin.core.min.js.map